<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Stream Racer ‚Äì Streamer Ready (No-Base64)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <style>
        :root {
            --bg: #0b1220;
            --panel: #0f172a;
            --text: #e5e7eb;
            --muted: #94a3b8;
            --accent: #7c3aed;
            --danger: #ef4444;
            --border: #22304b;
            --lane-gap: 8px;
            --lane-height: 10vh;
            --racer-size: 7vh;
            --banner-top-h: 15; /* vh */
            --banner-bot-h: 15; /* vh */
            --header-h: 0px;
            --stage-min-h: auto; /* computed from JS: 100vh - header - topBanner - bottomBanner */
        }

        * {
            box-sizing: border-box
        }

        html, body {
            height: 100%
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
            color: var(--text);
            background: linear-gradient(180deg, #0b1220 0%, #0e1a35 100%);
        }

        /* Layout */
        .app {
            display: flex;
            flex-direction: column;
            height: 100vh; /* lock total app height to viewport */
            overflow: hidden; /* prevent scroll bar */
        }


        header {
            display: grid;
            grid-template-columns:auto 1fr auto;
            gap: 12px;
            align-items: center;
            padding: 8px 12px;
            border-bottom: 1px solid var(--border);
            background: rgba(15, 23, 42, .7);
            backdrop-filter: blur(4px);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        #logo {
            height: 48px;
            width: auto;
            object-fit: contain;
        }

        #title {
            font-weight: 800;
            font-size: clamp(18px, 2.5vw, 32px)
        }

        .controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: flex-end
        }

        button {
            background: #111a31;
            color: #e5e7eb;
            border: 1px solid var(--border);
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
        }

        button.primary {
            background: linear-gradient(180deg, var(--accent), #5b21b6);
            border-color: transparent
        }

        button.danger {
            background: linear-gradient(180deg, var(--danger), #b91c1c);
            border-color: transparent
        }

        /* Streamer banners */
        .banner {
            display: grid;
            place-items: center;
            width: 100%;
            height: calc(var(--vh, 1vh) * var(--banner-h));
            background: #0b1328;
            border-bottom: 1px dashed #1f2d4a;
        }

        .banner.bottom {
            border-top: 1px dashed #1f2d4a;
            border-bottom: none
        }

        .banner img {
            max-height: 100%;
            max-width: 100%;
            object-fit: contain;
        }

        /* Stage */
        .stage {
            /* Take exactly the leftover height between banners */
            min-height: 0; /* allow it to shrink so bottom banner fits */
            display: flex;
            flex-direction: column;
            justify-content: center; /* centers track vertically when stage > track */
            align-items: center;
            gap: 8px;
            padding: 8px 10px; /* keep a little breathing room */
        }

        #track {
            position: relative;
            width: min(1800px, 96vw); /* better on 4K, still scales down nicely */
            height: auto;
            padding: 14px;
            border: 1px solid #1e2a44;
            border-radius: 16px;
            background: #0c1834;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, .25);
            margin: 0; /* prevent extra gap around track */
        }

        .finish-line {
            position: absolute;
            top: 0;
            right: 12%;
            width: 10px;
            height: 100%;
            z-index: 1;
            opacity: .8;
            background: repeating-linear-gradient(45deg, #fff 0 10px, #000 10px 20px);
            mix-blend-mode: screen;
        }

        .lane {
            position: relative;
            height: var(--lane-height);
            margin-bottom: var(--lane-gap);
            background: rgba(255, 255, 255, .05);
            border: 1px solid #22304b;
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            align-items: center;
        }

        .lane::before {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            opacity: .4;
            background: linear-gradient(90deg, rgba(255, 255, 255, .15) 0 2px, transparent 2px 22px),
            linear-gradient(180deg, rgba(255, 255, 255, .08) 0 50%, transparent 50% 100%);
            background-size: 22px 100%, 100% 16px;
            animation: scrollBg 1.2s linear infinite;
        }

        @keyframes scrollBg {
            to {
                background-position-x: -22px, 0;
                background-position-y: 0, 16px;
            }
        }

        .racer {
            position: absolute;
            left: 0;
            width: var(--racer-size);
            height: var(--racer-size);
            display: grid;
            grid-template-rows:auto auto;
            justify-items: center;
            align-items: end;
            transform-origin: center;
            filter: drop-shadow(0 6px 10px rgba(0, 0, 0, .35));
        }

        .avatar {
            width: 100%;
            height: 100%;
            border-radius: 10px;
            object-fit: contain;
            background: transparent;
            border: none;
        }

        .nameplate {
            position: absolute;
            top: -1.9em;
            left: 50%;
            transform: translateX(-50%);
            padding: 2px 8px;
            background: rgba(0, 0, 0, .7);
            color: #fff;
            border-radius: 999px;
            font-size: clamp(11px, 1.8vh, 15px);
            white-space: nowrap;
            max-width: none;
            overflow: visible;
        }

        /* FX */
        .roll {
            animation: rollSpin 1.3s linear infinite;
        }

        @keyframes rollSpin {
            to {
                transform: rotate(360deg);
            }
        }

        .floaty {
            animation: floatBob 1.8s ease-in-out infinite;
        }

        @keyframes floatBob {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-6%);
            }
        }

        .wheelie {
            animation: wheelieTilt 1.2s ease-in-out infinite;
        }

        @keyframes wheelieTilt {
            0%, 100% {
                transform: rotate(0);
            }
            50% {
                transform: rotate(-10deg);
            }
        }

        /* Winner/podium */
        #winnerBanner {
            position: fixed;
            inset: 0;
            display: none;
            place-items: center;
            z-index: 50;
            pointer-events: none;
        }

        #winnerText {
            padding: 12px 18px;
            background: #000;
            color: #fff;
            font-weight: 900;
            font-size: clamp(20px, 4.5vw, 56px);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, .5);
        }

        .lane.winner {
            box-shadow: 0 0 0 3px #ffd54f inset, 0 0 0 3px #ffd54f;
            animation: glow 1s ease-in-out infinite alternate;
        }

        @keyframes glow {
            to {
                box-shadow: 0 0 0 6px #ffd54f88 inset, 0 0 0 6px #ffd54f88;
            }
        }

        #podium {
            position: absolute;
            right: 10px;
            top: 10px;
            z-index: 5;
            display: none;
            background: rgba(0, 0, 0, .55);
            border: 1px solid #22304b;
            border-radius: 12px;
            padding: 8px 10px;
            backdrop-filter: blur(4px);
            font-weight: 800;
            color: #fff;
        }

        #podium div {
            padding: 2px 0;
        }

        /* Modal */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .5);
            display: none;
            place-items: center;
            z-index: 100;
        }

        .modal {
            width: min(1050px, 96vw);
            max-height: 92vh;
            overflow: auto;
            background: #0f172a;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
        }

        .grid {
            display: grid;
            gap: 12px;
        }

        .cols-2 {
            grid-template-columns: 1fr 1fr;
        }

        .cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .field {
            display: grid;
            gap: 6px;
        }

        .field label {
            font-size: 12px;
            color: var(--muted);
        }

        input[type="text"], input[type="number"], input[type="file"], select, textarea {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: #0b1223;
            color: var(--text);
        }

        textarea {
            min-height: 110px;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
        }

        .players {
            border-top: 1px dashed var(--border);
            padding-top: 10px;
        }

        .player-row {
            display: grid;
            grid-template-columns: 36px 1fr 1fr 1fr auto;
            gap: 8px;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px dashed #1a2644;
        }

        .player-row img {
            width: 36px;
            height: 36px;
            object-fit: contain;
            border-radius: 8px;
            background: transparent;
            border: 1px solid #1a2644;
        }

        .right {
            text-align: right
        }

        @media (max-width: 720px) {
            :root {
                --lane-height: 11vh;
                --racer-size: 8vh;
            }

            .player-row {
                grid-template-columns: 28px 1fr 1fr 1fr auto;
            }
        }
    </style>
</head>
<body>
<div class="app">

    <header>
        <img id="logo" alt="Logo"/>
        <div id="title">Giveaway Grand Prix</div>
        <div class="controls">
            <button id="btnSettings">Settings</button>
            <button id="btnStart" class="primary">Start Race</button>
            <button id="btnReset">Reset</button>
        </div>
    </header>

    <!-- Top banner -->
    <div id="bannerTop" class="banner" style="--banner-h: var(--banner-top-h);">
        <img id="bannerTopImg" alt="Top Banner" style="max-height: calc(var(--vh, 1vh) * var(--banner-top-h));"/>
    </div>

    <div class="stage">
        <div id="track">
            <div class="finish-line" aria-hidden="true"></div>
            <div id="podium"></div>
            <!-- lanes injected -->
        </div>
    </div>

    <!-- Bottom banner -->
    <div id="bannerBottom" class="banner bottom" style="--banner-h: var(--banner-bot-h);">
        <img id="bannerBottomImg" alt="Bottom Banner" style="max-height: calc(var(--vh, 1vh) * var(--banner-bot-h));"/>
    </div>


    <!-- Winner overlay -->
    <div id="winnerBanner">
        <div id="winnerText">üèÅ Winner: <span id="winnerName"></span></div>
    </div>

    <!-- Settings Modal -->
    <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
        <div class="modal">
            <h2 id="settingsTitle" style="margin:8px 0 12px">Race Settings</h2>

            <div class="grid cols-3">
                <div class="field">
                    <label for="inpTitle">Race Title</label>
                    <input id="inpTitle" type="text" placeholder="Giveaway Grand Prix"/>
                </div>
                <div class="field">
                    <label for="inpLogo">Logo (transparent PNG/SVG recommended)</label>
                    <input id="inpLogo" type="file" accept="image/*"/>
                </div>
                <div class="field">
                    <label for="inpDuration">Race Duration (seconds)</label>
                    <input id="inpDuration" type="number" min="5" max="600" step="1" value="35"/>
                </div>
                <div class="field">
                    <label for="inpFinishPct">Finish Line (% from right)</label>
                    <input id="inpFinishPct" type="number" min="2" max="30" step="1" value="12"/>
                </div>
                <div class="field">
                    <label for="inpChaos">Chaos Level (0‚Äì1)</label>
                    <input id="inpChaos" type="number" min="0" max="1" step="0.05" value="0.6"/>
                </div>
                <div class="field">
                    <label for="inpRubber">Rubber-Band Strength (0‚Äì1)</label>
                    <input id="inpRubber" type="number" min="0" max="1" step="0.05" value="0.7"/>
                </div>
                <div class="field">
                    <label for="inpFxAll">Apply same FX to all players</label>
                    <select id="inpFxAll">
                        <option value="off">off</option>
                        <option value="roll">roll (marbles)</option>
                        <option value="floaty">floaty (ducks)</option>
                        <option value="wheelie">wheelie (cars)</option>
                    </select>
                </div>
                <div class="field">
                    <label for="inpLeadPhases">Lead changes (phases)</label>
                    <input id="inpLeadPhases" type="number" min="1" max="10" step="1" value="3"/>
                </div>
            </div>

            <h3 style="margin:14px 0 8px">Streamer Banners</h3>
            <div class="grid cols-2">
                <div class="field">
                    <label for="inpBannerTop">Top Banner Image</label>
                    <input id="inpBannerTop" type="file" accept="image/*"/>
                </div>
                <div class="field">
                    <label for="inpTopH">Top Banner Height (vh)</label>
                    <input id="inpTopH" type="number" min="0" max="40" step="1" value="10"/>
                </div>
                <div class="field">
                    <label for="inpBannerBottom">Bottom Banner Image</label>
                    <input id="inpBannerBottom" type="file" accept="image/*"/>
                </div>
                <div class="field">
                    <label for="inpBotH">Bottom Banner Height (vh)</label>
                    <input id="inpBotH" type="number" min="0" max="40" step="1" value="10"/>
                </div>
            </div>

            <h3 style="margin:14px 0 8px">Avatar Pool</h3>
            <div class="grid cols-3">
                <div class="field">
                    <label for="inpPoolMode">Pool Source</label>
                    <select id="inpPoolMode">
                        <option value="emotes">Emotes (default)</option>
                        <option value="images">Images</option>
                    </select>
                </div>
                <div class="field">
                    <label for="inpEmotes">Emotes (one per line)</label>
                    <textarea id="inpEmotes">ü¶Ü
üèéÔ∏è
üü£
üöÄ
üê¢</textarea>
                </div>
                <div class="field">
                    <label for="inpPoolImages">Image Pool (multi-select)</label>
                    <input id="inpPoolImages" type="file" accept="image/*" multiple/>
                </div>
            </div>
            <div style="display:flex; gap:8px; margin-top:-6px;">
                <button id="btnApplyPool">Apply Pool to Players (random)</button>
            </div>

            <h3 style="margin:14px 0 8px">Names (one per line)</h3>
            <div class="grid">
                <textarea id="inpNames" placeholder="One name per line"></textarea>
                <div style="display:flex; gap:8px; flex-wrap:wrap">
                    <button id="btnLoadNames">Load From Textarea</button>
                    <button id="btnExportNames">Export Names (.txt)</button>
                    <button id="btnCopyNames">Copy Names</button>
                </div>
            </div>

            <h3 style="margin:14px 0 8px">Players</h3>
            <div class="players">
                <div class="player-row" style="font-weight:700; opacity:.7;">
                    <div>#</div>
                    <div>Name</div>
                    <div>Avatar</div>
                    <div>Motion</div>
                    <div class="right">Remove</div>
                </div>
                <div id="playerList"></div>
                <div style="display:flex; gap:8px; margin-top:8px;">
                    <button id="btnAddPlayer">Add Player</button>
                    <button id="btnClearPlayers" class="danger">Clear All</button>
                </div>
            </div>

            <h3 style="margin:14px 0 8px">Config - Good Luck</h3>
            <div style="display:flex; gap:8px; flex-wrap:wrap">
                <button id="btnExportConfig">Export Config (.json)</button>
                <input id="inpImportConfig" type="file" accept="application/json" hidden/>
                <button id="btnImportConfig">Import Config (.json)</button>
            </div>

            <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:14px;">
                <button id="btnClose">Close</button>
                <button id="btnSave" class="primary">Save</button>
            </div>
        </div>
    </div>

</div>

<script src="js/racer.js?v17"></script>
</body>
</html>
